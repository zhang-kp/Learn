# Git

[Link](https://mp.weixin.qq.com/s/WSloXbauYnecGTFWizH9HQ)
### 安装

- Windows安装

下载git，一路next即可。
安装成功后，在你的开始菜单中找到Git Bash，点击Git Bash，输入git —version查看git版本号


- Linux 安装

> sudo apt-get install git


- 基本配置

> $ git config --global user.name "zhangsan"    
  $ git config --global user.email "111@qq.com"
  
> 查看配置  git config --list


### 工作区与暂存区

工作区——>暂存区——>本都仓库

1. 工作区很好理解，就是我们能看到的工作目录，就是本地的文件夹。
2. 这些本地的文件夹我们要通过git add命令先将他们添加到暂存区中。
3. git commit命令则可以将暂存区中的文件提交到本地仓库中去。


### 基本操作

#### 初始化仓库
仓库的初始化有两种方式：一种是直接从远程仓库克隆，另一种则是直接从当前目录初始化，这里我们主要介绍当前目录初始化，远程仓库克隆我们在后面的文章中会说到。从当前目录初始化的方式很简单，直接执行如下命令:
> git init

执行完成后当前目录下会多出一个.git的隐藏文件夹，所有git需要的数据和资源都存放在该目录中。

#### 查看仓库状态
> git status

#### 添加文件到暂存区
 > git add xxx
 
#### 提交到本地仓库
> git commit -m "xxx"   
提交成功之后，我们可以通过如下命令修改提交备注：
git commit --amend
运行该命令，会自动打开vi编辑器，此时我们可以重新编辑上次提交的备注信息。

#### 查看提交日志

> git log (--pretty=short，这样显示出来的只是简略信息)
- 此时显示出来的是我们这个仓库中的所有日志信息，如果我只想查看某一个文件的提交日志，在git log后面加上文件名即可
- 如果我还想查看提交时文件的变化，加上-p参数即可,绿色的+表示新增的行，红色的-表示删除的行

> 但是git log有一个局限性，就是不能查看已经删除的commit的日志，举个例子：下班了，我发现今天下午提交的代码全都是有问题的，于是做了一个版本回退，回退到今天早上的状态，然后关机回家，第二天来了后我发现搞错了，其实那些代码都是OK的，于是我又想让仓库版本前进到昨天下午的状态，却发现git log命令查看不到昨天下午提交的版本号。此时，我们可以使用git reflog命令来实现这一个请求，git reflog命令可以显示整个本地仓库的commit, 包括所有branch的commit, 甚至包括已经撤销的commit, 只要HEAD发生了变化, 就会在reflog里面看得到，而git log只显示当前分支的commit，并且不显示删除掉的commit

#### 查看更改前后的差异
- 使用git diff命令我们可以查看工作区和暂存区的区别以及工作区和最新提交的差别
- git diff HEAD 查看工作区和本地仓库的差别

#### 压缩提交历史

- git rebase -i命令可以实现提交历史的压缩。比如我们在开发某一个功能时，提交了很多次，当所有功能都写完时，想将这些提交压缩为一个，就可以使用该命令
- 该命令执行之后，会自动打开一个vi编辑器，在vi编辑器中将最新提交的日志的pick改为fixup即可。压缩之后，最新一次的提交日志就没了，但是数据还在。


### 回退
#### 工作区的代码想撤销
-  git checkout -- <file>
> 首先我们执行了git status命令，发现工作区是干净的，然后执行了cat命令，发现文件只有两行内容，然后通过vi编辑器向文件中添加一行，保存并退出，退出来之后又执行了git status命令，此时工作区的状态已经发生变化，然后我们执行了git checkout — git01.txt命令，表示撤销之前的操作，让git01.txt恢复到之前的状态，该命令执行成功之后，我们再执行cat命令发现文件内容已经恢复了，此时再执行git status，状态也恢复了。

#### add到暂存区的代码想撤销

如果想要撤销，但是代码已经提交到暂存区了，不用担心，也能撤销，分两个步骤：

1.将暂存区的代码撤销到工作区
2.将工作区的代码撤销(具体操作和’工作区的代码想撤销’一致)

将暂存区的代码撤销，我们可以使用git reset HEAD命令来实现

#### 提交到本地仓库的代码想撤销

同样的，提交到本地仓库的代码一样也可以撤销，我们可以利用git reset --hard <版本号>命令来实现版本回退，该命令中的版本号有几种不同的写法：

  1. 可以使用HEAD^来描述版本，一个^表示前一个版本，两个^^表示前两个版本，以此类推。
  2. 也可以使用数字来代替^，比如说前100个版本可以写作HEAD~100。
  3. 也可以直接写版本号，表示跳转到某一个版本处。我们每次提交成功后，都会生成一个哈希码作为版本号，所以这里我们也可以直接填版本号，哈希码很长，但是我们不用全部输入，只需要输入前面几个字符即可，就能识别出来。
  
操作步骤：
1. 通过git log查看当前提交日志
2. 通过git reset HEAD^^向前回退两个版本
3. 查看日志，发现最后一次提交的版本号是695ce1fe,利用git reset —hard 695ce1fe命令回到回退之前的状态
4. 通过git reset —hard HEAD~1回到上一个版本


### 分支管理

#### 查看分支
> git branch 
#### 分支创建和切换
> git branch <分支名> 创建一个分支，git checkout <分支名> 切换分支

> git checkout -b <分支名> 一步到位，创建并切换分支

#### 分支合并
> 待处理


### 远程仓库

#### 配置SSH KEY 
SSH KEY的配置不是必须的，不配置的话我们就只能使用HTTPS协议，这样每次提交时要输入用户名密码，略麻烦，所以还是配置一下。配置SSH KEY的原理很简单，采用非对称加密方式生成公钥和私钥，公钥告诉GitHub，私钥留在自己电脑上(私钥不可泄露)，当我们向GitHub上提交数据时，GitHub会用我们留给它的公钥加密一段消息返回给我们的电脑，如果我们能够用私钥解密成功，说明是合法的用户，这样就避免我们输入用户名密码了。大致的原理就是这样，现在很多免登录的系统都采用了这种方式，比如Hadoop免登录配置也是这样。

#### 查看本地是否已有SSHKEY
> ls -la ~/.ssh

#### 生成SSH指纹
> ssh-keygen -t rsa -b 4096 -C "你的邮箱地址"

#### 添加ssh到ssh-agent中

> eval "$(ssh-agent -s)"

OK，做好这一切之后，我们当前用户目录下已经有了一个名为.ssh的隐藏文件夹了，打开这个目录，会发现有一个名为id_rsa.pub的文件，这就是我们一会要使用的公钥文件。

#### 将公钥告诉GitHub


#### 关联远程仓库

> git remote add origin git@github.com:lenve/test.git
### 推送到远程仓库
#### 推送到master分支
> git push -u origin master

-u参数可以在推送的同时，将origin 仓库的master 分支设置为本地仓库当前分支的upstream（上游）。添加了这个参数，将来运行git pull命令从远程仓库获取内容时，本地仓库的这个分支就可以直接从origin 的master 分支获取内容，省去了另外添加参数的麻烦。这个参数也只用在第一次push时加上，以后直接运行git push命令即可。

#### 推送到其他分支

如果想推送到其他分支，还是这条命令，修改一下分支的名字即可，比如我也想把我的fa分支推送到远程仓库中，执行如下命令：
> $ git checkout fa

>  $ git push -u origin fa
  
  先切换到fa分支，然后执行git push命令，参数含义和之前的一样，这里我们创建的远程仓库的分支名也为fa（当然我们可以取任何名字，但是为了不混淆，最好取一致的名字）
  
### 从远程仓库获取

#### 首次获取
> git clone git@github.com:lenve/test.git

此时克隆的远程仓库的master分支到本地仓库，我们可以通过git branch -a来查看本地仓库和远程仓库的信息，-a参数可以同时显示本地仓库和远程仓库的信息

我们看到远程仓库中已经有了fa分支了，如果我们想把fa分支也克隆下来，执行如下命令：
>   git checkout -b fa origin/fa

表示根据远程仓库的fa分支创建一个本地仓库的fa分支，创建完成之后进行切换，也可以通过如下命令只创建不切换：
>   git branch fa origin/fa

#### 从远程仓库更新
此时我们回到第一次最早的那个test本地仓库中，那个test仓库的fa分支现在和远程仓库不一致了，我们可以通过git pull命令来更新

### Git 标签管理





